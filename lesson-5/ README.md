# Terraform Infrastructure Project ‚Äî Lesson 5

–¶–µ–π –ø—Ä–æ—î–∫—Ç —Å—Ç–≤–æ—Ä—é—î –±–∞–∑–æ–≤—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ AWS –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Terraform. –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∫–ª—é—á–∞—î:

- S3-–±–∞–∫–µ—Ç –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É (`terraform.tfstate`) —Ç–∞ DynamoDB –¥–ª—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è,
- VPC —ñ–∑ –ø—É–±–ª—ñ—á–Ω–∏–º–∏ —ñ –ø—Ä–∏–≤–∞—Ç–Ω–∏–º–∏ –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏,
- ECR-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è Docker-–æ–±—Ä–∞–∑—ñ–≤.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```
lesson-5/
‚îÇ
‚îú‚îÄ‚îÄ main.tf # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤
‚îú‚îÄ‚îÄ backend.tf # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∫–µ–Ω–¥—É –¥–ª—è —Å—Ç–µ–π—Ç—ñ–≤ (S3 + DynamoDB)
‚îú‚îÄ‚îÄ outputs.tf # –ó–∞–≥–∞–ª—å–Ω–µ –≤–∏–≤–µ–¥–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
‚îÇ
‚îú‚îÄ‚îÄ modules/ # –ö–∞—Ç–∞–ª–æ–≥ –∑ —É—Å—ñ–º–∞ –º–æ–¥—É–ª—è–º–∏
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ s3-backend/ # –ú–æ–¥—É–ª—å –¥–ª—è S3 —Ç–∞ DynamoDB
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ s3.tf # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è S3-–±–∞–∫–µ—Ç–∞
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ dynamodb.tf # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è DynamoDB
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ variables.tf # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è S3
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ outputs.tf # –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ S3 —Ç–∞ DynamoDB
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ vpc/ # –ú–æ–¥—É–ª—å –¥–ª—è VPC
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ vpc.tf # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è VPC, –ø—ñ–¥–º–µ—Ä–µ–∂, Internet Gateway
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ routes.tf # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ variables.tf # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è VPC
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ outputs.tf # –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ VPC
‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ ecr/ # –ú–æ–¥—É–ª—å –¥–ª—è ECR
‚îÇ ‚îú‚îÄ‚îÄ ecr.tf # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
‚îÇ ‚îú‚îÄ‚îÄ variables.tf # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è ECR
‚îÇ ‚îî‚îÄ‚îÄ outputs.tf # –í–∏–≤–µ–¥–µ–Ω–Ω—è URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é ECR
‚îÇ
‚îî‚îÄ‚îÄ README.md # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –ø—Ä–æ—î–∫—Ç—É
```

## üöÄ –ö–æ–º–∞–Ω–¥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫—É

```bash
# 1. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Terraform-–ø—Ä–æ—î–∫—Ç—É
terraform init

# 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –±—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ
terraform plan

# 3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
terraform apply

# 4. –í–∏–¥–∞–ª–µ–Ω–Ω—è –≤—Å—ñ—î—ó —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
terraform destroy
```

üì¶ –û–ø–∏—Å –º–æ–¥—É–ª—ñ–≤

üìÅ modules/s3-backend

–ú–æ–¥—É–ª—å —Å—Ç–≤–æ—Ä—é—î:

    ‚Ä¢ S3-–±–∞–∫–µ—Ç –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è terraform.tfstate
    ‚Ä¢ –£–≤—ñ–º–∫–Ω–µ–Ω–µ versioning
    ‚Ä¢ DynamoDB-—Ç–∞–±–ª–∏—Ü—é –¥–ª—è state locking

üìÅ modules/vpc

–ú–æ–¥—É–ª—å —Å—Ç–≤–æ—Ä—é—î:

    ‚Ä¢ VPC –∑ –≤–∫–∞–∑–∞–Ω–∏–º CIDR-–±–ª–æ–∫–æ–º
    ‚Ä¢ –ü—É–±–ª—ñ—á–Ω—ñ —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –ø—ñ–¥–º–µ—Ä–µ–∂—ñ —É 3-—Ö –∑–æ–Ω–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ
    ‚Ä¢ Internet Gateway, NAT Gateway —Ç–∞ Route Tables

üìÅ modules/ecr

–ú–æ–¥—É–ª—å —Å—Ç–≤–æ—Ä—é—î:

    ‚Ä¢ Amazon ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –∑ —ñ–º º—è–º, –ø–µ—Ä–µ–¥–∞–Ω–∏–º —É ecr_name
    ‚Ä¢ –ù–∞–ª–∞—à—Ç–æ–≤—É—î —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –æ–±—Ä–∞–∑—ñ–≤ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π (—è–∫—â–æ scan_on_push = true)
    ‚Ä¢ –ü–æ–≤–µ—Ä—Ç–∞—î URL, ARN —Ç–∞ –Ω–∞–∑–≤—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é —á–µ—Ä–µ–∑ outputs

‚∏ª

üìã ! –í–∏–º–æ–≥–∏ !

    ‚Ä¢ AWS CLI –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π (aws configure)
    ‚Ä¢ Terraform ‚â• 1.3
    ‚Ä¢ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ:
    ‚Ä¢ s3
    ‚Ä¢ dynamodb
    ‚Ä¢ ecr

–°—Ç–≤–æ—Ä–µ–Ω–∏–π:

- DynamoDB —Ç–∞–±–ª–∏—Ü—è

```
aws dynamodb create-table \
   --table-name terraform-locks \
   --attribute-definitions AttributeName=LockID,AttributeType=S \
   --key-schema AttributeName=LockID,KeyType=HASH \
   --billing-mode PAY_PER_REQUEST \
   --region us-west-2
```

- S3 bucket

```
aws s3api create-bucket \
  --bucket –°–í–û–Ñ –Ü–ú º–Ø \
  --region us-west-2 \
  --create-bucket-configuration LocationConstraint=us-west-2
```

‚∏ª

üß© Outputs

–ü—ñ—Å–ª—è terraform apply –±—É–¥—É—Ç—å –≤–∏–≤–µ–¥–µ–Ω—ñ:

    ‚Ä¢ s3_bucket_name
    ‚Ä¢ dynamodb_table_name
    ‚Ä¢ ecr_repository_name
    ‚Ä¢ ecr_repository_url
    ‚Ä¢ ecr_repository_arn
